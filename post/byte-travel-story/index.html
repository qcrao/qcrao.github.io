<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>一个字节的网络漫游故事独白 | qcrao 的博客</title><meta property="og:title" content="一个字节的网络漫游故事独白 - qcrao 的博客"><meta property="og:type" content="article"><meta property="article:published_time" content="2019-01-30T06:48:00+08:00"><meta property="article:modified_time" content="2019-01-30T06:48:00+08:00"><meta name=Keywords content="golang,go语言,后端,个人成长"><meta name=description content="一个字节的网络漫游故事独白"><meta name=author content="饶全成"><meta property="og:url" content="https://qcrao.com/post/byte-travel-story/"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/style.css><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<link href=https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css rel=stylesheet></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><a id=logo href=https://qcrao.com>qcrao 的博客</a><p class=description>专注于 Go 语言(golang)、后端架构、个人成长</p></div><div><nav id=nav-menu class=clearfix><a class=current href=https://qcrao.com>首页</a>
<a href=https://qcrao.com/archives/ title=归档>归档</a>
<a href=https://qcrao.com/about/ title=关于>关于</a>
<a href=https://qcrao.com/readings/ title=阅读>阅读</a>
<a href=https://qcrao.com/ishare/ title=分享>分享</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一个字节的网络漫游故事独白</h1></header><date class="post-meta meta-date">2019年1月30日</date><div class=post-meta><span id=busuanzi_container_page_pv>|<span id=busuanzi_value_page_pv></span><span>
阅读</span></span></div><div class=post-content><p>大家好，给大家介绍一下，我是一个字节。相比于你们人类据说即将达到的百岁人生的寿命，我的一生简直不直一提（我只能存活零点几个毫秒）。</p><p>也许只有那些码农才会了解我，而且也只有一部分码农。那些整天做业务的猿们想来也不会真正的了解我，更别提人类其他行业的人了。</p><p>我不甘心，虽然我微不足道，但是我对人类的贡献实在是太大了。没有我的世界根本无法想像：不能听网易云音乐，不能刷抖音，不能上拼多多，所有和网络相关的活动都无法进行。</p><p>所以，今天我要讲讲我的一生，让更多的人知道我的存在，知道我的故事，也为证明自己曾经存在过吧。</p><h1 id=诞生>诞生</h1><p>我的主人是一个在西二旗知名互联网公司上班的程序猿，过着1095（注：早10点晚9点，一周5天工作）的生活，很少能在晚霞中回家，自然也说不出“落霞与孤鹜齐飞”那样的句子。</p><p>这一天，他9点半到家，第一件事打开电脑，熟练地启动chrome浏览器，在地址栏敲下一个<code>z</code>字符，我所有的故事就从这里开始。</p><p>当主人按下键盘上的<code>z</code>键时，系统了产生一个中断信号，通知CPU过来读取键盘输入，CPU读取到<code>z</code>后，将<code>z</code>发送给chrome浏览器, chrome收到后，将<code>z</code>显示到浏览器的地址栏上，同时后台搜索主人平时访问过的地址，排名第一的<code>https://www.zhihu.com/</code>被快速补全了。</p><p>这时主人熟练地按下了回车键，chrome收到指令后，进行了一顿操作，在这电光火石之间，我诞生了，同时诞生的还有我的字节兄弟们。</p><h1 id=上路>上路</h1><p>话说<code>Chorme老大哥</code>接收到了URL后，首先拆解成自己能看懂的东西。<code>https://www.zhihu.com</code>会被拆解成三部分：<code>https</code>、<code>www.zhihu.com</code>、<code>/</code></p><p><code>https</code>表示协议类型，通过这个<code>Chorme老大哥</code>知道他接下来该如何与远方的网站服务器通信；<code>www.zhihu.com</code>表示主机名，就是Chorme老大哥要通信的对象了；第三部分则是它要向服务器要的内容（注：这里表明是空，实际上隐含的表示主目录文件的概念）。</p><p>有了这三项，<code>Chorme老大哥</code>就能从服务器那里获取它想要的内容了，从而展示给我的主人。</p><p><code>Chorme老大哥</code>跑到<code>HTTP数据包生产车间</code>，哼哧哼哧地倒腾半天，生产出了一个HTTP数据包（注：忽略https, 简单起见我们当成http），这个数据包实际上就是我和我的一群字节兄弟们，我们挤在一个集装箱内，熙熙攘攘。</p><p>我们马上就要搭乘<code>IP列车</code>到远方的服务器，见识外面的世界了。集装箱被装上了<code>TCP专车</code>，它将带我们来到列车站。<code>TCP专车</code>很安全也很舒适，我从集装箱的缝隙中看到车前贴上了车牌：<code>80</code>.</p><p>到了车站，<code>TCP专车</code>直接开到了列车上。这样也好，<code>IP列车</code>上很脏，我们坐在专车上更好。 只是列车还不知道具体要去哪，所以我们就只能先在列车上等着了。</p><p>不对啊，列车应该去<code>www.zhihu.com</code>这个网站，不是已经知道了吗？对的，但是<code>IP列车</code>挺笨的，也挺古板的，不认识这些字母。它只认识数字，人类称之为ip.</p><p><code>Chorme老大哥</code>也有点抱怨，人类真是笨，连个ip都记不住，非得用域名来上网。害我还得拿着这个域名去问<code>DNS老大爷</code>，它知道所有域名对应的ip.</p><p>这不，<code>Chorme老大哥</code>又跑到另外一个车间————<code>DNS数据包生产车间</code>里倒腾出了一个DNS数据包，当然还是一群字节兄弟们，不过这里的兄弟就少一些了。它们在集装箱里叽叽喳喳，被装上了<code>UDP敞篷车</code>，车虽然很快，但不太安全，我这些兄弟们坐在上面，提心吊胆，生怕掉下去，因为掉下去，就永远消失了。</p><p><code>UDP敞篷车</code>也直接开到了<code>IP列车</code>上，车前贴了车牌：53.</p><p>这回Chrome老大哥直接从<code>操作系统大佬</code>那要到了<code>DNS老大爷</code>的ip, 贴到了<code>IP列车</code>的车头，<code>IP列车</code>马上全速启动，载着我这些字节兄弟，赶到了<code>DNS老大爷</code>的城堡，<code>UDP敞篷车</code>开下列车，按照车牌号53找到了<code>DNS老大爷</code>的住处。从它那拿到了<code>www.zhihu.com</code>对应的ip.</p><p><code>DNS老大爷</code>学问渊博，他也很仗义，从自己城堡里的<code>DNS数据包生产车间</code>造出了DNS响应包，包里也是我这些字节兄弟们，它们拿着重要的资料数据————<code>www.zhihu.com</code>对应的ip, 坐上了另一趟返程的<code>IP列车</code>，而列车的终点就是我现在所在的地方。当然了，他们是由另一辆<code>UDP敞篷车</code>载着他们回来的。</p><p><code>Chorme老大哥</code>在车间接见了这些兄弟，非常感动。因为他们带回了<code>www.zhihu.com</code>对应的ip. 那些兄弟争先恐后的报告自己知道的东西，有些兄弟报告1, 有些兄弟报告0, <code>Chorme老大哥</code>非常有经验，它把这些消息合并起来了，最终得到了它想要的ip: 118.89.204.192.</p><p><code>Chorme老大哥</code>拿着这个ip来到了我所在的列车前面，我激动地要叫起来了：终于我要出发了！它熟练地把<code>118.89.204.192</code>贴到了列车的前面，马上列车就开动了，我上路了。</p><p><code>IP列车</code>的列车长在掌管着车头的方向，决定着我们的命运走向。路网非常复杂，而车头上只有一个ip地址，根本没告诉列车长应该走哪条路。这不难，富有经验的列车长根据车头的ip地址查到了下一个大站（路由器）的地址，之后再根据这个大站地址查到（ARP协议）途经的下一个小站（交换机或集线器）应该走的轨道。在每个小站，对照这个大站地址，列车长就知道该走哪条路。搞定！</p><p>经过了很多的小站，我们终于到了下一个大站了。站点的工作人员看着我们车头前的ip地址，查了下表（路由表）告诉我们下一个大站的地址，并且告诉我们途径的下一个小站应该走哪条轨道。列车长就这样，一路拿这张表，顺利地把们带到了终点：
<code>118.89.204.192</code>.</p><p>不过，刚刚就在到终点的前一刻，列车被拦住了，一群荷枪实弹的警卫冲上来了，一些胆小的字节兄弟们都哭了，我也是屏气凝声。他们先是查看了车头的ip地址，再查看了列车长手里的表，还看了下我们的<code>TCP专车</code>的车牌。很快就放行了，虚惊一场！</p><h1 id=新生>新生</h1><p>到了终点站后，列车首先停下接受工作人员的检查。列车长出示了他手里的表，对了一下表上标注的下一站地址确实是：知乎。接着又看了下列车头部标注的ip地址，就算检查通过了，第一关很轻松。</p><p>接下来，我们坐的<code>TCP专车</code>开下列车了。进了一个<code>TCP车牌检查站</code>，工作人员看了下车牌号80, 也挥手示意我们通过。</p><p>接着我们都下车走进了<code>主页车间</code>，进去后，我们先按我们身上的标号排好了位置，工作人员将我们每个人所代表的信息进行了聚拢。得到了各种关于主人的信息，比如他所用的浏览器的版本，cookie等等信息，我知道，我们的使命完成了。果然，一道光闪过，我们都消失了，完成了我们光荣的一生。</p><p><code>主页车间</code>领导马上下达生产命令：1组去仓库拉取最新话题，2组去商业中心获取今天的广告主信息……</p><p>很快，各组都完成了任务，车间在一阵轰鸣过后，新的一批字节兄弟诞生了，他们带着这些话题、广告信息，和我们当年出生的时候一样，熙熙攘攘。但是我知道，我获得了新生。</p><h1 id=归家>归家</h1><p>像我们当年一样，这些新出生的字节兄弟依次坐上了<code>TCP专车</code>，<code>IP列车</code>一路跋涉，去往我出发的地方，那是我梦开始的地方。</p><p>我所经历的，他们未曾少过一分。</p><h1 id=定格>定格</h1><p><code>Chrome老大哥</code>终于等来了这些字节兄弟，在他们排好队后，老大哥看清了字节兄弟们代表的内容：话题<code>如何在西二旗地铁优雅地装逼</code>，热度10w, 广告<code>上午植发，下午上班</code>……</p><p>这些是<code>Chrome老大哥</code>最擅长的事情，分分钟将他们显示在了网页上。字节兄弟们终于完成了使命，定格在了retina屏幕上。</p><p>我的主人点开第一话题后，看了一会儿。然后瞅到了到植发广告，他偷偷地开启了隐身模式，仔细地研究了起来……</p><h1 id=后记>后记</h1><p>第一次尝试这种题材的文章，供大家一乐！有写得不到位的地方，欢迎大家补充！</p><p>另外，推荐大家去看《网络是怎样连接的》，看完可以形成对网络的整体印象。写得非常好！</p><p><a data-fancybox=gallery href=https://user-images.githubusercontent.com/7698088/51420568-305b1800-1bce-11e9-962a-52b12be7eb2e.png><img class=mx-auto alt=QR src=https://user-images.githubusercontent.com/7698088/51420568-305b1800-1bce-11e9-962a-52b12be7eb2e.png></a></p><h1 id=参考资料>参考资料</h1><p>【知乎回答】 <a href=https://www.zhihu.com/question/292704461/answer/482549197>https://www.zhihu.com/question/292704461/answer/482549197</a></p><p>【当我们谈网络时】 <a href=https://segmentfault.com/a/1190000004094420>https://segmentfault.com/a/1190000004094420</a></p><p>【按下键盘时】 <a href=https://www.zhihu.com/question/29707696>https://www.zhihu.com/question/29707696</a></p><p>【mac地址和ip地址】 <a href=http://blog.sciencenet.cn/blog-411071-1037673.html>http://blog.sciencenet.cn/blog-411071-1037673.html</a></p></div><div class=post-archive><ul class=post-copyright><li><strong>原文作者：</strong><a rel=author href=https://qcrao.com>饶全成</a></li><li style=word-break:break-all><strong>原文链接：</strong><a href=https://qcrao.com/post/byte-travel-story/>https://qcrao.com/post/byte-travel-story/</a></li><li><strong>版权声明：</strong>本作品采用<a rel=license href=https://creativecommons.org/licenses/by-nc-nd/4.0/>知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li></ul></div><br></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=qcrao/blog_comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer id=footer><div>&copy; 2022 <a href=https://qcrao.com>qcrao 的博客 By 饶全成</a>
| <a rel=nofollow target=_blank href=http://beian.miit.gov.cn/>鄂ICP备20006251号-1</a></div><br><div><div class=github-badge><a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a></div><div class=github-badge><a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a></div><div class=github-badge><a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a></div></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[["$","$"]],processEscapes:!0}}</script><script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src=//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js></script>
<a id=rocket href=#top></a>
<script type=text/javascript src='/js/totop.js?v=0.0.0' async></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-144930666-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async></script>
<script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "15ed44493a8a4df682815ddf8c84ff23"}'></script></div><div id=secondary><section class=widget><form id=search action=https://qcrao.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://qcrao.com>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><h3 class=widget-title>最近文章</h3><ul class=widget-list><li><a href=https://qcrao.com/post/100-go-mistakes-reading-notes/ title="深度阅读之《100 Go Mistakes and How to Avoid Them》">深度阅读之《100 Go Mistakes and How to Avoid Them》</a></li><li><a href=https://qcrao.com/post/memory-leak-of-go-map/ title="Go map 竟然也会发生内存泄漏？">Go map 竟然也会发生内存泄漏？</a></li><li><a href=https://qcrao.com/post/what-is-upstream-downstream/ title="你说的下游是 upstream 吧？">你说的下游是 upstream 吧？</a></li><li><a href=https://qcrao.com/post/migrate-blog-to-cloudflare-pages/ title="将博客迁移到了 Cloudflare Pages">将博客迁移到了 Cloudflare Pages</a></li><li><a href=https://qcrao.com/post/blogs-written-by-xargin/ title=那些年曹大写的文章>那些年曹大写的文章</a></li><li><a href=https://qcrao.com/post/content-is-more-important/ title=最重要的是内容>最重要的是内容</a></li><li><a href=https://qcrao.com/post/look-up-go-doc-gracefully/ title="写 Go 时如何优雅地查文档">写 Go 时如何优雅地查文档</a></li><li><a href=https://qcrao.com/post/talk-about-map-extra-field/ title="曹大带我学 Go（11）—— 从 map 的 extra 字段谈起">曹大带我学 Go（11）—— 从 map 的 extra 字段谈起</a></li><li><a href=https://qcrao.com/post/go-tls-pr-by-xargin/ title="曹大带我学 Go（10）—— 如何给 Go 提性能优化的 pr">曹大带我学 Go（10）—— 如何给 Go 提性能优化的 pr</a></li><li><a href=https://qcrao.com/post/start-to-build-up-personal-tools/ title="曹大带我学 Go（9）—— 开始积累自己的工具库">曹大带我学 Go（9）—— 开始积累自己的工具库</a></li></ul></section><section class=widget><h3 class=widget-title>我写的书</h3><ul class=widget-list><li><a href=https://golang.design/go-questions/ title="《Go 程序员面试笔试宝典》" target=_blank style=color:red><img src=/book.png></a></li></ul></section><section class=widget><h3 class=widget-title>友情链接</h3><ul class=widget-list><li><a target=_blank href=https://www.xargin.com/ title=曹大的博客>曹大的博客</a></li><li><a target=_blank href=https://eddycjy.com/ title=煎鱼的博客>煎鱼的博客</a></li><li><a target=_blank href=http://lessisbetter.site/ title=大彬的博客>大彬的博客</a></li><li><a target=_blank href=https://wujunze.com/ title="Panda 的博客">Panda 的博客</a></li><li><a target=_blank href=https://mytechshares.com/ title=董泽润>董泽润</a></li></ul></section><section class=widget><h3 class=widget-title>其它</h3><ul class=widget-list><li><a href=https://qcrao.com/index.xml>文章 RSS</a></li></ul></section></div></div></div></div></body></html>