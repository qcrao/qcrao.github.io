<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>曹大带我学 Go（9）—— 开始积累自己的工具库 | qcrao 的博客</title><meta property="og:title" content="曹大带我学 Go（9）—— 开始积累自己的工具库 - qcrao 的博客"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-07-21T23:42:31+08:00"><meta property="article:modified_time" content="2021-07-21T23:42:31+08:00"><meta name=Keywords content="golang,go语言,后端,个人成长"><meta name=description content="曹大带我学 Go（9）—— 开始积累自己的工具库"><meta name=author content="饶全成"><meta property="og:url" content="https://qcrao.com/post/start-to-build-up-personal-tools/"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/style.css><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<link href=https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css rel=stylesheet></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><a id=logo href=https://qcrao.com>qcrao 的博客</a><p class=description>专注于 Go 语言(golang)、后端架构、个人成长</p></div><div><nav id=nav-menu class=clearfix><a class=current href=https://qcrao.com>首页</a>
<a href=https://qcrao.com/archives/ title=归档>归档</a>
<a href=https://qcrao.com/about/ title=关于>关于</a>
<a href=https://qcrao.com/readings/ title=阅读>阅读</a>
<a href=https://qcrao.com/ishare/ title=分享>分享</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>曹大带我学 Go（9）—— 开始积累自己的工具库</h1></header><date class="post-meta meta-date">2021年7月21日</date><div class=post-meta><span id=busuanzi_container_page_pv>|<span id=busuanzi_value_page_pv></span><span>
阅读</span></span></div><div class=post-content><p>不知道你有没有这样的经验：看了很多计算机相关的书，觉得自己懂得很多，但是一遇到实际问题，就不会解。</p><p>再看身边的老司机，执行几行命令，看了几个指标，就准确地定位问题了。他可能也没看那么多理论，但实战能力确实强，心里一下子就失衡了。</p><p>这其中有很多原因，我认为其中有一个比较重要的就是：工具的使用。老司机因为经验多，积累了很多 命令、shell 脚本、代码库……这些东西就像瑞士军刀，关键时刻，直接就可以派上大用场。在线上出问题的时候，云淡风轻地说，这行代码有问题，删掉就可以了。潇洒至极！</p><p>今天我就把我最近积累的一些工具，包括一些软件、命令，这些是可以直接用于实战的。希望看完之后，能提升你的战斗力。</p><h1 id=效率工具>效率工具</h1><p>今天推荐 2 个我日常用得比较多的，提升效率的软件：aText、paste。</p><h2 id=atext>aText</h2><p><code>aText</code> 是一个输入映射的软件，输入预先设定的字符串，就可以转成设定好的目标字符串。我用 aText 存了很多有用的映射，例如，我把打开博客文章的命令缩写成了 <code>XPosts</code>：</p><p><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210720232555.png><img class=mx-auto alt src=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210720232555.png></a></p><p>因为博客文件所在的路径比较长，如果我每次都直接敲出完整路径的话，会很麻烦。有了这个映射后，只用输入 <code>XPosts</code> 就自动变成了我要的文件路径。</p><p>还有很多场景可以使用 <code>aText</code>，尤其是你经常要输入的相同的内容，非常方便。</p><h2 id=paste>paste</h2><p><code>paste</code> 管理剪贴版的历史，只要是你复制过的内容，它都会保存下来，甚至可以对文本内容进行搜索。</p><p>比如可以把开发、排查问题时常用的链接、命令都放到一个 tab 下面，要用的时候，直接快捷键调出，怎一个优雅了得。</p><p><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210720234152.png><img class=mx-auto alt src=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210720234152.png></a></p><h1 id=命令>命令</h1><p>这部分挑了一些非常有用的命令出来，大家可以记在笔记里，关键时候直接拿出来用。</p><h2 id=查看-cache-size>查看 cache size</h2><p>看 Go 源码的时候，经常能看到一些 pad 字段，这个字段主要是用来防止 <code>false sharing</code>，一般是根据 cache line size 来算 pad 大小的。那么查看这个 size 的大小呢？</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>getconf LEVEL1_DCACHE_LINESIZE
</span></span></code></pre></div><h2 id=查看内核版本>查看内核版本</h2><p>有时候会遇到一些和内核版本相关的问题，例如 Go 语言里面的内存归还策略在 Go 1.12 有一个改动，将 <code>MADV_FREE</code> 改成了 <code>MADV_DONTNEED</code>，导致线上应⽤的 RSS ⼤幅上升。</p><blockquote><p>使用 <code>MADV_FREE</code> 方式，程序内存不会立刻回收，即 RSS 值不会立刻下降，只有当 OS 内存紧缺时才会回收 Go 程序的内存；</p></blockquote><blockquote><p>而 Go 1.11 以及之前的版本默认采用的是 <code>MADV_DONTNEED</code> 方式，程序 RSS 值下降很快。</p></blockquote><blockquote><p>因此如果需要使程序内存占用下降很慢的话，可设置环境变量 <code>GODEBUG=madvdontneed=1</code>。</p></blockquote><p>另外，<code>MADV_FREE</code> 只在 Linux 4.5 及之后的版本才有，所以当你遇到 RSS 一直降不下去的场景时，要想确认是不是这个问题导致的，还得看你的内核版本是啥。那就用这个命令：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>uname -a
</span></span></code></pre></div><p>这个归还内存的策略在 Go 1.16 又改回去了。因此只有在 Go 1.12-Go 1.15 之间，且是 Linux 4.5 及之后的内核版本才会有这个问题。</p><p><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210721082338.png><img class=mx-auto alt src=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210721082338.png></a></p><h2 id=输出代码行号>输出代码行号</h2><p>有时候需要用 <code>cat</code> 命令输出一段代码，截图发给别人。这时如果需要对着代码行号做一些说明的话，把代码行号一并输出来是非常 nice 的，只需要用这个命令：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat -n a.go
</span></span></code></pre></div><p><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210721000709.png><img class=mx-auto alt src=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210721000709.png></a></p><h2 id=汇总展示代码构成>汇总展示代码构成</h2><p>当我们想看一个开源项目的代码行数的时候，并且能看到各种类型的语言各占多少的时候，怎么办呢？一个命令搞定：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>tokei ./
</span></span></code></pre></div><p><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210721001151.png><img class=mx-auto alt src=https://cdn.jsdelivr.net/gh/qcrao/images/blog/20210721001151.png></a></p><p>就问你强不强！</p><p>这个用在什么场景呢？太多了，例如你准备看一个稍微简单一点的框架，有几个侯选的：chi, echo, gin……执行一下命令，看看代码行数，选择一个最少的。</p><h1 id=后记>后记</h1><p>工具是很重要的，积累了很多前人的智慧，我们拿来直接用，不需要自己再从零开始。当然，适当地学习原理也是必须的。</p><p>我们要记住这些命令，存入自己的工具库，要用的时候直接调出来。它们可以节省我们大脑的内存，把宝贵的资源用在思考真正的问题上，而不是记住这些命令。</p><p>而且当我们有了自己的代码码、脚本库、工具库的时候，遇到问题，拿上相应的家伙上场，马上就可以得到很多相关的信息，我们再根据这些信息做决策。</p><p>今天就先列这些吧，其实还准备了好几个关于 Go 的，先不放出来。如果这篇比较受欢迎，就下期再写了。</p><p>最后，也欢迎在留言区分享你的工具，无论是软件，还是一行命令。我会汇总后再分享给大家，切实有效地提升大家的能力。</p></div><div class=post-archive><ul class=post-copyright><li><strong>原文作者：</strong><a rel=author href=https://qcrao.com>饶全成</a></li><li style=word-break:break-all><strong>原文链接：</strong><a href=https://qcrao.com/post/start-to-build-up-personal-tools/>https://qcrao.com/post/start-to-build-up-personal-tools/</a></li><li><strong>版权声明：</strong>本作品采用<a rel=license href=https://creativecommons.org/licenses/by-nc-nd/4.0/>知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li></ul></div><br></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=qcrao/blog_comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer id=footer><div>&copy; 2022 <a href=https://qcrao.com>qcrao 的博客 By 饶全成</a>
| <a rel=nofollow target=_blank href=http://beian.miit.gov.cn/>鄂ICP备20006251号-1</a></div><br><div><div class=github-badge><a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a></div><div class=github-badge><a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a></div><div class=github-badge><a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a></div></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[["$","$"]],processEscapes:!0}}</script><script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src=//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js></script>
<a id=rocket href=#top></a>
<script type=text/javascript src='/js/totop.js?v=0.0.0' async></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-144930666-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async></script>
<script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "15ed44493a8a4df682815ddf8c84ff23"}'></script></div><div id=secondary><section class=widget><form id=search action=https://qcrao.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://qcrao.com>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><h3 class=widget-title>最近文章</h3><ul class=widget-list><li><a href=https://qcrao.com/post/memory-leak-of-go-map/ title="Go map 竟然也会发生内存泄露？">Go map 竟然也会发生内存泄露？</a></li><li><a href=https://qcrao.com/post/what-is-upstream-downstream/ title="你说的下游是 upstream 吧？">你说的下游是 upstream 吧？</a></li><li><a href=https://qcrao.com/post/migrate-blog-to-cloudflare-pages/ title="将博客迁移到了 Cloudflare Pages">将博客迁移到了 Cloudflare Pages</a></li><li><a href=https://qcrao.com/post/blogs-written-by-xargin/ title=那些年曹大写的文章>那些年曹大写的文章</a></li><li><a href=https://qcrao.com/post/content-is-more-important/ title=最重要的是内容>最重要的是内容</a></li><li><a href=https://qcrao.com/post/look-up-go-doc-gracefully/ title="写 Go 时如何优雅地查文档">写 Go 时如何优雅地查文档</a></li><li><a href=https://qcrao.com/post/talk-about-map-extra-field/ title="曹大带我学 Go（11）—— 从 map 的 extra 字段谈起">曹大带我学 Go（11）—— 从 map 的 extra 字段谈起</a></li><li><a href=https://qcrao.com/post/go-tls-pr-by-xargin/ title="曹大带我学 Go（10）—— 如何给 Go 提性能优化的 pr">曹大带我学 Go（10）—— 如何给 Go 提性能优化的 pr</a></li><li><a href=https://qcrao.com/post/start-to-build-up-personal-tools/ title="曹大带我学 Go（9）—— 开始积累自己的工具库">曹大带我学 Go（9）—— 开始积累自己的工具库</a></li><li><a href=https://qcrao.com/post/accident-by-a-metric/ title="曹大带我学 Go（8）—— 一个 metrics 打点引发的事故">曹大带我学 Go（8）—— 一个 metrics 打点引发的事故</a></li></ul></section><section class=widget><h3 class=widget-title>我写的书</h3><ul class=widget-list><li><a href=https://golang.design/go-questions/ title="《Go 程序员面试笔试宝典》" target=_blank style=color:red><img src=/book.png></a></li></ul></section><section class=widget><h3 class=widget-title>友情链接</h3><ul class=widget-list><li><a target=_blank href=https://www.xargin.com/ title=曹大的博客>曹大的博客</a></li><li><a target=_blank href=https://eddycjy.com/ title=煎鱼的博客>煎鱼的博客</a></li><li><a target=_blank href=http://lessisbetter.site/ title=大彬的博客>大彬的博客</a></li><li><a target=_blank href=https://wujunze.com/ title="Panda 的博客">Panda 的博客</a></li><li><a target=_blank href=https://mytechshares.com/ title=董泽润>董泽润</a></li></ul></section><section class=widget><h3 class=widget-title>其它</h3><ul class=widget-list><li><a href=https://qcrao.com/index.xml>文章 RSS</a></li></ul></section></div></div></div></div></body></html>