<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>将博客迁移到了 Cloudflare Pages | qcrao 的博客</title><meta property="og:title" content="将博客迁移到了 Cloudflare Pages - qcrao 的博客"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-07-19T22:20:00+08:00"><meta property="article:modified_time" content="2022-07-19T22:20:00+08:00"><meta name=Keywords content="golang,go语言,后端,个人成长"><meta name=description content="将博客迁移到了 Cloudflare Pages"><meta name=author content="饶全成"><meta property="og:url" content="https://qcrao.com/post/migrate-blog-to-cloudflare-pages/"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/style.css><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<link href=https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css rel=stylesheet></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><a id=logo href=https://qcrao.com>qcrao 的博客</a><p class=description>专注于 Go 语言(golang)、后端架构、个人成长</p></div><div><nav id=nav-menu class=clearfix><a class=current href=https://qcrao.com>首页</a>
<a href=https://qcrao.com/archives/ title=归档>归档</a>
<a href=https://qcrao.com/about/ title=关于>关于</a>
<a href=https://qcrao.com/readings/ title=阅读>阅读</a>
<a href=https://qcrao.com/ishare/ title=分享>分享</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>将博客迁移到了 Cloudflare Pages</h1></header><date class="post-meta meta-date">2022年7月19日</date><div class=post-meta><span id=busuanzi_container_page_pv>|<span id=busuanzi_value_page_pv></span><span>
阅读</span></span></div><div class=post-content><p>上个月把博客从 hexo 迁移到了 hugo，博客数据、发布流程全部托管到 github，把之前写的一篇《那些年曹大写的文章》搬了过来，其他文章都暂时下线了。</p><p>上周在折腾博客 css 文件的时候，aofei 说不如迁移到 Cloudflare，还能全球 cdn 加速。于是又动手迁移到 cloudflare，顺便又修改了一些 css，现在博客样式也比较顺我的意。这篇文章记录下折腾的过程，希望能给读者带来一些参考。接下来就是开始规律地更新博客了。</p><h1 id=迁移到-cloudflare-pages>迁移到 Cloudflare Pages</h1><p>Cloudflare Pages 和 Github Pages 都能方便地部署静态博客页面，但前者功能更强大，不仅支持自动部署，设置页面规则将 <a href=https://www.qcrao.com>www.qcrao.com</a> 重定向到 qcrao.com，还能配置 url 路径规则自动重定向，管理 DNS 解析规则，并且能够直接分析页面访问量（之前是基于 google analytic）。</p><p>迁移过程其实很简单，在 <a href=https://dash.cloudflare.com/03a0b92508177f06a435b73b0a3fe47c/pages>Cloudflare Pages</a> 页面，创建部署，目录设置成 github 上的 blog repo。设置部署命令，接着只要 blog repo 有更新，这边就会自动部署。</p><p><a data-fancybox=gallery href=./2022-07-19-22-46-31.png><img class=mx-auto alt src=./2022-07-19-22-46-31.png></a></p><p>这里需要注意的是一点是通过<a href=https://developers.cloudflare.com/pages/framework-guides/deploy-a-hugo-site/#using-a-specific-hugo-version>设置环境变量</a>来控制 hugo 的版本，否则你在本地看到的效果和线上效果会有差异。我当时是 Cloudflare 生成的页面不能点击图片进行放大。</p><h1 id=cdn-配置>CDN 配置</h1><p>Cloudflare Pages 上对CDN 配置步骤有一些提示和说明，还是比较友好的。</p><p>因为我之前的域名在腾讯云上托管，这回得修改 DNS 服务器到 Cloudflare，这个需要去腾讯云域名管理页面修改。</p><p><a data-fancybox=gallery href=2022-07-19-22-55-49.png><img class=mx-auto alt src=2022-07-19-22-55-49.png></a></p><p>下面这条 <code>www -> qcrao.com</code> 的记录是在为了让我们在输入 <code>https://www.qcrao.com</code> 的情况下转到 <code>https://qcrao.com</code>。</p><p>另外，Cloudflare 会自动将证书设置好，这些都不用我们关心。</p><h1 id=老文章重定向>老文章重定向</h1><p>之前用 hexo 的时候，文章路径里面会带上日期，非常长。切到 hugo 后，路径没有日期了，且加上了一个 post 路径。如果不设置一下，老链接就会失效。</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>https://qcrao.com/2019/04/02/dive-into-go-slice
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>-&gt;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>https://qcrao.com/post/dive-into-go-slice/
</span></span></code></pre></div><p>Cloudflare 刚好有一个<a href=https://developers.cloudflare.com/pages/platform/redirects/>重定向的功能</a>，非常方便，一行命令就解决了：</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>/:year/:month/:day/* /post/:splat
</span></span></code></pre></div><p>将老链接的年、月、日匹配上，splat 表示 * 号内容，这样就能把年月日从 url 中去掉，并且加上了 <code>/post</code> 路径。重定向的功能就自然完成了，且非常顺滑。</p><p>当我访问 <code>https://qcrao.com/2019/04/02/dive-into-go-slice</code> 时，会自动跳转：</p><p><a data-fancybox=gallery href=2022-07-20-00-09-23.png><img class=mx-auto alt src=2022-07-20-00-09-23.png></a></p><p>注意看路径，我只需要把原来的 md 文件搬过来就可以无缝跳转了！</p><h1 id=css-美化>CSS 美化</h1><p>很惭愧，我并不会 CSS，虽然很多大佬说特别简单，下次一定学😅。</p><p>一开始想要美化 CSS 的原因是在手机端看博客文章时，结尾部分的版权声明字体非常大，而文章正文的字体又显得特别小（特地比较了一下<a href=https://xargin.com>曹大博客</a>在手机端的效果）。</p><p><a data-fancybox=gallery href=2022-07-20-00-13-21.png><img class=mx-auto alt src=2022-07-20-00-13-21.png></a></p><p>当然我自己是不知道怎么『美化』的，所以请教了 aofei，几行代码就解决了：</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#111>@</span><span style=color:#00a8c8>media</span> <span style=color:#f92672>only</span> <span style=color:#f92672>screen</span> <span style=color:#f92672>and</span> <span style=color:#f92672>(</span><span style=color:#f92672>max-width</span><span style=color:#f92672>:</span> <span style=color:#f92672>800px</span><span style=color:#f92672>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#111>.</span><span style=color:#75af00>post-archive</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>        <span style=color:#00a8c8>font-size</span><span style=color:#111>:</span> <span style=color:#ae81ff>16</span><span style=color:#00a8c8>px</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#111>.</span><span style=color:#75af00>post-content</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        <span style=color:#00a8c8>font-size</span><span style=color:#111>:</span> <span style=color:#ae81ff>16</span><span style=color:#00a8c8>px</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#111>.</span><span style=color:#75af00>post-archive</span> <span style=color:#f92672>h2</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>          <span style=color:#00a8c8>margin</span><span style=color:#111>:</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>          <span style=color:#00a8c8>font</span><span style=color:#111>:</span> <span style=color:#00a8c8>bold</span> <span style=color:#ae81ff>16</span><span style=color:#00a8c8>px</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>1.1</span> <span style=color:#d88200>&#34;ff-tisa-web-pro&#34;</span><span style=color:#111>,</span> <span style=color:#111>Cambria</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;Times New Roman&#34;</span><span style=color:#111>,</span> <span style=color:#111>Georgia</span><span style=color:#111>,</span> <span style=color:#111>Times</span><span style=color:#111>,</span> <span style=color:#00a8c8>sans-serif</span><span style=color:#111>;</span> 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#111>.</span><span style=color:#75af00>post-archive</span> <span style=color:#111>.</span><span style=color:#75af00>date</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>        <span style=color:#00a8c8>font-size</span><span style=color:#111>:</span> <span style=color:#ae81ff>16</span><span style=color:#00a8c8>px</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        <span style=color:#00a8c8>padding-right</span><span style=color:#111>:</span> <span style=color:#ae81ff>.7</span><span style=color:#00a8c8>em</span><span style=color:#111>;</span> 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#111>}</span>
</span></span></code></pre></div><p>第一行代码其实就是限定条件是限定在小屏幕下，执行之后的 CSS。大括号里面匹配哪些元素其实就要用到谷歌浏览器的检查功能了。</p><p>问了几次 aofei 后，我自己成功地将 cmd markdown 渲染出来的引用格式移植到了博客上。</p><p>过程也很简单：先用检查功能找到 cmd markdown 页面上的引用那块对应什么元素，然后在它的 css 文件里找到对应的代码，copy 到本地 css 就 ok 了。好在 hugo 足够快，改完代码后就能马上看到效果，所以可以不断尝试。</p><h1 id=static-下面的文件会移动网站根目录>static 下面的文件会移动网站根目录</h1><p>当我们想把一些文件在执行 hugo 命令后放到根目录下，只需要将它放到 <code>themes/maupassant/static</code> 就行了。例如，博客首页右边栏下放了一张《Go 程序员面试笔记宝典》，这个图片需要在所有情况下展示，是一个全局的资源。</p><p><a data-fancybox=gallery href=2022-07-19-23-23-03.png><img class=mx-auto alt src=2022-07-19-23-23-03.png></a></p><p>因此图片路径要用 <code>/book.png</code>。一开始我用的是 <code>book.png</code>，结果我切到『归档』页面后，图片就不展示了。</p><p>博客样式可能暂时就折腾到这里为止，之后要有规律的更新文章了。</p><p>毕竟内容才是最重要的！</p></div><div class=post-archive><ul class=post-copyright><li><strong>原文作者：</strong><a rel=author href=https://qcrao.com>饶全成</a></li><li style=word-break:break-all><strong>原文链接：</strong><a href=https://qcrao.com/post/migrate-blog-to-cloudflare-pages/>https://qcrao.com/post/migrate-blog-to-cloudflare-pages/</a></li><li><strong>版权声明：</strong>本作品采用<a rel=license href=https://creativecommons.org/licenses/by-nc-nd/4.0/>知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li></ul></div><br></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=qcrao/blog_comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer id=footer><div>&copy; 2022 <a href=https://qcrao.com>qcrao 的博客 By 饶全成</a>
| <a rel=nofollow target=_blank href=http://beian.miit.gov.cn/>鄂ICP备20006251号-1</a></div><br><div><div class=github-badge><a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a></div><div class=github-badge><a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a></div><div class=github-badge><a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a></div></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[["$","$"]],processEscapes:!0}}</script><script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src=//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js></script>
<a id=rocket href=#top></a>
<script type=text/javascript src='/js/totop.js?v=0.0.0' async></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-144930666-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async></script>
<script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "15ed44493a8a4df682815ddf8c84ff23"}'></script></div><div id=secondary><section class=widget><form id=search action=https://qcrao.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://qcrao.com>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><h3 class=widget-title>最近文章</h3><ul class=widget-list><li><a href=https://qcrao.com/post/migrate-blog-to-cloudflare-pages/ title="将博客迁移到了 Cloudflare Pages">将博客迁移到了 Cloudflare Pages</a></li><li><a href=https://qcrao.com/post/blogs-written-by-xargin/ title=那些年曹大写的文章>那些年曹大写的文章</a></li><li><a href=https://qcrao.com/post/content-is-more-important/ title=最重要的是内容>最重要的是内容</a></li></ul></section><section class=widget><h3 class=widget-title>我写的书</h3><ul class=widget-list><li><a href=https://golang.design/go-questions/ title="《Go 程序员面试笔试宝典》" target=_blank style=color:red><img src=/book.png></a></li></ul></section><section class=widget><h3 class=widget-title>友情链接</h3><ul class=widget-list><li><a target=_blank href=https://www.xargin.com/ title=曹大的博客>曹大的博客</a></li><li><a target=_blank href=https://eddycjy.com/ title=煎鱼的博客>煎鱼的博客</a></li><li><a target=_blank href=http://lessisbetter.site/ title=大彬的博客>大彬的博客</a></li><li><a target=_blank href=https://wujunze.com/ title="Panda 的博客">Panda 的博客</a></li><li><a target=_blank href=https://mytechshares.com/ title=董泽润>董泽润</a></li></ul></section><section class=widget><h3 class=widget-title>其它</h3><ul class=widget-list><li><a href=https://qcrao.com/index.xml>文章 RSS</a></li></ul></section></div></div></div></div></body></html>